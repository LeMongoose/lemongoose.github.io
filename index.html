<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Test Blog</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Test Blog </a></h1>
                <nav><ul>
                    <li><a href="/category/code.html">Code</a></li>
                    <li><a href="/category/communications.html">Communications</a></li>
                    <li><a href="/category/licence-copyright.html">Licence Copyright</a></li>
                    <li><a href="/category/topography.html">Topography</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/sphere-fitting.html">A general algorithm for finding the n-sphere that exactly fits point cloud of n+2 points</a></h1>
<footer class="post-info">
        <abbr class="published" title="2020-12-02T19:00:17+11:00">
                Published: Wed 02 December 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/calum-cookson.html">Calum Cookson</a>
        </address>
<p>In <a href="/category/code.html">Code</a>.</p>
<p>tags: <a href="/tag/code.html">code</a> </p>
</footer><!-- /.post-info --><h1>Sphere fitting - Demystified (and an algorithm)</h1>
<p><a href="#algorithm">tldr: gimme the algorithm</a></p>
<h2>Introduction</h2>
<p>The need to find a line that connects a set of points is a common problem in data science.  Perhaps the most common and simplest of these is the special case of <em>Linear Regression</em> with two known values.</p>
<div class="math">$$\begin{document}
f(x) = mx+c : f(x) \rightarrow y\\
x_0\rightarrow x : f(x)\rightarrow y_0 \\
x_1\rightarrow x : f(x)\rightarrow y_1 \\
$$</div>
<p>Given points <span class="math">\((1,3) \rightarrow (x_0, y_0) : (2,5) \rightarrow (x_1, y_1)\)</span> we need to find the values of <span class="math">\(m\)</span> and <span class="math">\(c\)</span> that, when plugged into <span class="math">\(f(x)\)</span>, maps <span class="math">\(f(x_0)\)</span> to <span class="math">\(y_0\)</span> and <span class="math">\(f(x_1)\)</span> to <span class="math">\(y_1\)</span></p>
<p>$$\begin{document}</p>
<p>1 \rightarrow x_0 : f(x_0) \rightarrow y_0 \rightarrow 3\
2 \rightarrow x_1 : f(x_0) \rightarrow y_1 \rightarrow 5\</p>
<p>m \leftarrow \dfrac{|x_1-x_0|}{|y_1-y_0|} \leftarrow 2 : c \leftarrow y_0 - mx_0 \leftarrow 1
$$</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">mark_point</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">annotation</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">annotation</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">xn</span><span class="p">,</span><span class="n">yn</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span><span class="n">yn</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>

<span class="n">mark_point</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">mark_point</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>


<p>A more involved case is finding the function that maps a circle onto a set of points.  There are several equations for a circle, depending on how you think of the circle.</p>
<p>The most general equation for the circle is </p>
<p><a id='algorithm'></a></p>
<h1>Algorithm for the general case of fitting a set of points to an n-sphere</h1>
<h2>An n-what?</h2>
<p>An n-sphere is the generalisation of the ordinary spheres to higher dimensional spaces.</p>
<p>An n-sphere is a twiddler where the points on the surface are the same distance <span class="math">\(r\)</span> from a central point <span class="math">\(p\)</span>, the centre point of the sphere.</p>
<p>A circle is a 1-sphere and the standard sphere (ball) is a 2-sphere.  This can be a source of confusion, an n-sphere is usually represented (the technical term is <em>embedded</em>) in an <span class="math">\(n+1\)</span> dimensional space.  A circle (1-sphere) is embedded in 2 dimensions, a sphere (2-sphere) is embedded in 3 dimensions and so on.
A unique n-sphere in a <span class="math">\(n+1\)</span> embedding can be derived with <span class="math">\(n+2\)</span> points.  So:
* a unique circle (1-sphere) passes through 3 points in a 2 dimensional embedding.
* a unique sphere (2-sphere) passes through 4 points in a 3 dimensional embedding.</p>
<p>The algorthms above work fine for 2 and 3 dimensions, but become unwieldy at higher dimensions.  What is needed is a general algorthm that takes <span class="math">\(n\)</span>points and fits an <span class="math">\((n-2)\)</span>-sphere to them.</p>
<p>Of course, there is nothing stopping an n sphere being embedded in higher than n+1 dimensions, but this will have to be catered for in the algorithm for reasons that will be explained.</p>
<p>Let P be the set of points <span class="math">\((1,1) : (2,3) : (-1,5)\)</span>  </p>
<div class="math">$$
P \leftarrow 
\begin{pmatrix}
1&amp;2&amp;-1\\
1&amp;3&amp;5\\
\end{pmatrix}
\\
$$</div>
<p>Find the vectors from one of the points <span class="math">\(P_0\)</span>, to all the others <span class="math">\(P_1 ... P_n\)</span> (<span class="math">\(P_0\)</span> could be any of the points, but I've used the first point for convenience)</p>
<div class="math">$$
P_0 \leftarrow 
\begin{pmatrix}
1\\
1\\
\end{pmatrix}\\
$$</div>
<div class="math">$$
P \leftarrow 
\begin{pmatrix}
2&amp;-1\\
3&amp;5\\
\end{pmatrix}\\
$$</div>
<div class="math">$$
V \leftarrow P-P_0 \\
V = 
\begin{pmatrix}
1&amp;-2\\
2&amp;4\\
\end{pmatrix}\\
$$</div>
<p>Calculate the unit vectors <span class="math">\(U_n\)</span> directed along <span class="math">\(V_n\)</span> from <span class="math">\(P_0\)</span></p>
<p>$$
    U_n \leftarrow \dfrac{V_n}{|V_n|}\
    U = </p>
<div class="math">\begin{pmatrix}
0.447&amp;-0.447\\
0.894&amp;0.894\\
\end{pmatrix}</div>
<p>\</p>
<p><span class="math">\($
Define the vector $R\)</span> as the vector from <span class="math">\(P_0\)</span> to the centre point of the n-sphere.
The projection of <span class="math">\(R\)</span> onto <span class="math">\(U_n\)</span> is the dot product of <span class="math">\(R\)</span> and <span class="math">\(U_n\)</span> and has length <span class="math">\(\dfrac{|V_n|}{2}\)</span></p>
<p>Declare a matrix <span class="math">\(W : W_n \leftarrow \dfrac{|V_n|}{2}\)</span></p>
<div class="math">$$
  U^T . R = W \\
  R = (U^T)^{-1}W \\
  R = \begin{pmatrix}
0.447&amp;0.894\\
-0.447&amp;0.894\\
\end{pmatrix}^{-1} 
\begin{pmatrix}
1.118\\
2.236\\
\end{pmatrix}
$$</div>
<div class="math">$$
R = \begin{pmatrix}
1.119&amp;-1.119\\
0.559&amp;0.559\\
\end{pmatrix}
\begin{pmatrix}
1.118\\
2.236\\
\end{pmatrix}
=\begin{pmatrix}
-1.251\\
1.876\\
\end{pmatrix}
$$</div>
<p>The centre of the circle is then simply:
</p>
<div class="math">$$
R+P_0 = \begin{pmatrix}
-1.251\\
1.876\\
\end{pmatrix} + \begin{pmatrix}
1\\
1\\
\end{pmatrix} = \begin{pmatrix}
-0.251\\
2.876\\
\end{pmatrix}
$$</div>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">LA</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>

<span class="k">def</span> <span class="nf">arrow</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="n">_off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">head_width</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">)</span>
    <span class="c1">#ax.annotate(&quot;{0}&quot;.format(tuple(v)), v+_off, alpha=.5)</span>

<span class="k">def</span> <span class="nf">annotate_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">P</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&lt;</span><span class="si">{0}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p</span><span class="p">)),</span> <span class="n">p</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">condition</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">build_vector</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
       <span class="k">return</span> <span class="n">condition</span><span class="p">(</span>
           <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_p</span><span class="p">:</span> <span class="n">build_vector</span><span class="p">(</span><span class="n">_p</span><span class="p">,</span><span class="n">q</span><span class="p">),</span> <span class="n">p</span><span class="p">)</span>
           <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">condition</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_q</span><span class="p">:</span> <span class="n">build_vector</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">_q</span><span class="p">),</span> <span class="n">q</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">q</span><span class="o">-</span><span class="n">p</span>

<span class="k">def</span> <span class="nf">draw_vector</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="c1">#vector from p to q</span>
    <span class="n">p</span> <span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">V</span> <span class="o">=</span> <span class="n">build_vector</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
    <span class="n">arrow</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="n">p</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">V</span><span class="p">:</span>
        <span class="n">arrow</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>  

<span class="k">def</span> <span class="nf">show_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="n">annotate_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>

    <span class="n">p_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>
    <span class="n">draw_vector</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">p_0</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)])</span>
<span class="n">show_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="c1">#draw_vector(ax,p_0, P)</span>
</pre></div>


<p><img alt="svg" src="sphere_fitting_files/sphere_fitting_5_0.svg"></p>
<h2>The Algorithm</h2>
<p>The standard way of representing a matrix of vectors <span class="math">\(V_n\)</span> is in the form:
</p>
<div class="math">$$ 
V \leftarrow 
\begin{pmatrix}
v_0&amp;v_1&amp;...&amp;v_n\\
\end{pmatrix}
$$</div>
<p>
where each column of the matrix represents each vector.</p>
<p>Numpy, on the other hand, defaults to placing the vectors as the rows.</p>
<p>For this reason the algorithm below doesn't find the inverse of <span class="math">\(U^T\)</span>, it finds the inverse of <span class="math">\(U\)</span>.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">LA</span>

<span class="k">def</span> <span class="nf">nsphere_fit</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">p_0</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">P</span><span class="o">-</span><span class="n">p_0</span>
    <span class="n">N</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">,</span><span class="n">n</span><span class="p">:</span> <span class="n">v</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">),</span> <span class="n">V</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">LA</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">U</span><span class="p">)</span> <span class="o">@</span> <span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="n">p_0</span> <span class="c1"># Using pseudo inverse, see note below</span>
</pre></div>


<h2>Pseudo Inverse</h2>
<p>Observant viewers will notice the use of the pseudo inverse.  When using the basic algorithm, the inverse is used.  The matrix <span class="math">\(U\)</span> therefore is necessarily square, as only square matrices have true inverses.
When fitting an n-sphere to a greater than <span class="math">\(n+1\)</span> dimensional embedding, or when fitting an n-sphere to more than <span class="math">\(n+2\)</span> points the matrix <span class="math">\(U\)</span> will be non-square.
It is a valid operation to fit a circle to 3 points in a 3 dimensional space, but doing so would mean U would be a 3 by 2 matrix.</p>
<p>For the points:
<span class="math">\((1,1,1) : (2,-2,-2) : (3,4,-4)\)</span>
</p>
<div class="math">$$
P \leftarrow
\begin{pmatrix}
1&amp;2&amp;3\\
1&amp;-2&amp;4\\
1&amp;-2&amp;-4\\
\end{pmatrix}
$$</div>
<div class="math">$$
V \leftarrow P_{1...n} - P_0 \\
V = 
\begin{pmatrix}
1&amp;2\\
-3&amp;3\\
-3&amp;-3\\
\end{pmatrix}
$$</div>
<h2>Testing</h2>
<p>Testing on a circle (1-sphere) with a 2-D Embedding</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_circle</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="n">annotate_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">[</span><span class="n">Q</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>


<span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)])</span>
<span class="c1">#fig,ax = plt.subplots()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">show_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">Q</span> <span class="o">=</span> <span class="n">nsphere_fit</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="c1"># Q is centre point</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="n">Q</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
<span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span> <span class="c1"># sphere, so distance, r, from Q to P[0...n] equal</span>
<span class="n">draw_circle</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Centre of circle </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">Centre of circle [-0.25  2.88]</span>
<span class="err">[2.25346955 2.25346955 2.25346955]</span>
</pre></div>


<p><img alt="svg" src="sphere_fitting_files/sphere_fitting_9_1.svg"></p>
<div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
<span class="c1">#fig,ax = plt.subplots()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">show_points</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">Q</span> <span class="o">=</span> <span class="n">nsphere_fit</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="c1"># Q is centre point</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">LA</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="n">Q</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;r=</span><span class="si">{0}</span><span class="s2"> min=</span><span class="si">{1}</span><span class="s2"> mean=</span><span class="si">{2}</span><span class="s2"> max=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span>
<span class="n">draw_circle</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
<span class="n">draw_circle</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
<span class="n">draw_circle</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Centre of circle </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">r=[2.44636872 2.50850066 2.13095828 2.71380957 2.437239  ] min=2.130958277782115 mean=2.447375243529411 max=2.7138095686422177</span>
<span class="err">Centre of circle [-0.51  2.93]</span>
</pre></div>


<p><img alt="svg" src="sphere_fitting_files/sphere_fitting_11_1.svg"></p>
<div class="highlight"><pre><span></span>
</pre></div>


<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/delaunay-triangulation.html" rel="bookmark"
                           title="Permalink to Delaunay Triangulation Demystified">Delaunay Triangulation Demystified</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-11-02T19:00:17+11:00">
                Published: Mon 02 November 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/calum-cookson.html">Calum Cookson</a>
        </address>
<p>In <a href="/category/topography.html">Topography</a>.</p>
<p>tags: <a href="/tag/delaunay.html">delaunay</a> <a href="/tag/code.html">code</a> <a href="/tag/topography.html">topography</a> </p>
</footer><!-- /.post-info -->                <p>Delaunay Triangulation Explainer</p>
                <a class="readmore" href="/delaunay-triangulation.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/dynamical-systems.html" rel="bookmark"
                           title="Permalink to Dynamical Systems Communications">Dynamical Systems Communications</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-11-02T19:00:17+11:00">
                Published: Mon 02 November 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/calum-cookson.html">Calum Cookson</a>
        </address>
<p>In <a href="/category/communications.html">Communications</a>.</p>
<p>tags: <a href="/tag/dynamical.html">dynamical</a> <a href="/tag/communications.html">communications</a> </p>
</footer><!-- /.post-info -->                <p>Using Dynamical Systems To Encode Information</p>
                <a class="readmore" href="/dynamical-systems.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/function-objects.html" rel="bookmark"
                           title="Permalink to A Python Library For Investigating Dynamical Systems">A Python Library For Investigating Dynamical Systems</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-01-29T19:00:17+11:00">
                Published: Wed 29 January 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/calum-cookson.html">Calum Cookson</a>
        </address>
<p>In <a href="/category/code.html">Code</a>.</p>
<p>tags: <a href="/tag/code.html">code</a> </p>
</footer><!-- /.post-info -->                <p>Objects For Running and Analysing Functions</p>
                <a class="readmore" href="/function-objects.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/markdown-annotator.html" rel="bookmark"
                           title="Permalink to An Annotator for Markdown Files">An Annotator for Markdown Files</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-01-27T21:33:53+11:00">
                Published: Mon 27 January 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/calum-cookson.html">Calum Cookson</a>
        </address>
<p>In <a href="/category/code.html">Code</a>.</p>
<p>tags: <a href="/tag/code.html">code</a> <a href="/tag/jupyter.html">jupyter</a> <a href="/tag/markdown.html">markdown</a> </p>
</footer><!-- /.post-info -->                <p>File for adding meta data to start of Markdown File</p>
                <a class="readmore" href="/markdown-annotator.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/software-licencing.html" rel="bookmark"
                           title="Permalink to Licencing for Included Code">Licencing for Included Code</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-01-26T21:53:35+11:00">
                Published: Sun 26 January 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/calum-cookson.html">Calum Cookson</a>
        </address>
<p>In <a href="/category/licence-copyright.html">Licence Copyright</a>.</p>
<p>tags: <a href="/tag/code.html">code</a> <a href="/tag/licencing.html">licencing</a> <a href="/tag/licensing.html">licensing</a> <a href="/tag/copyright.html">copyright</a> </p>
</footer><!-- /.post-info -->                <p>All code on blog released under MIT Licence, unless otherwise stated</p>
                <a class="readmore" href="/software-licencing.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-157278336-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>